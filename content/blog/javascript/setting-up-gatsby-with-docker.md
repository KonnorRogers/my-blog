---
title: Setting up a Gatsby project with Docker
date: "2020-01-16T16:55:01"
description: How to setup a new gatsby project with docker within the current
  directory of your project
---

## Quick start

First create a new directory (or use an existing directory, this method will NOT
create a new git directory for you)

```bash
mkdir my-new-gatsby-project
cd my-new-gatsby-project
touch Dockerfile.dev docker-compose.yml package.json yarn.lock
```

</br>

Next step, we must fill in the `package.json` file.

There are 2 ways to handle this. You can either run `yarn init or npm init` if you have
yarn / npm installed on your computer.

However, if you do not have npm / yarn it is fine. The `package.json` just needs
some values to get Docker to run appropriately. Run the command below to fill in
a temporary `package.json` file.

```json
// ./package.json

{
  "name": "docker-with-gatsby",
  "description": "An example repo for setting up Gatsby with Docker",
  "version": "1.0.0",
  "main": "index.js",
  "repository": "git@github.com:ParamagicDev/docker-with-gatsby.git",
  "author": "paramagicdev <konnor5456@gmail.com>",
  "license": "MIT",
  "private": true
}
```

```dockerfile
# ./Dockerfile.dev

FROM node:13.6.0-alpine3.11

# Taken from https://www.stoutlabs.com/blog/2019-02-05-my-docker-setup-gatsby-next/
RUN \
  apk add --no-cache python make g++ git && \
  apk add vips-dev fftw-dev --no-cache --repository http://dl-3.alpinelinux.org/alpine/edge/community --repository http://dl-3.alpinelinux.org/alpine/edge/main && \
  rm -fR /var/cache/apk/*

RUN yarn global add gatsby-cli

# The port gatsby runs on
EXPOSE 8000

WORKDIR /myapp
COPY ./package.json /myapp
COPY ./yarn.lock /myapp
RUN yarn install && yarn cache clean
COPY . /myapp
CMD ["gatsby", "develop", "-H", "0.0.0.0" ]
```

```yaml
# ./docker-compose.yml

version: "3"
services:
  web:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
    volumes:
      - /myapp/node_modules
      - .:/myapp
    environment:
      - NODE_ENV=development
      - GATSBY_WEBPACK_PUBLICPATH=/
```

Your file structure should at least contain the following when running `tree .`:

```bash
.
├── docker-compose.yml
├── Dockerfile.dev
├── package.json
└── yarn.lock
```

[Reference Repository Commit](https://github.com/ParamagicDev/docker-with-gatsby/tree/initial-docker-setup)

After copying the contents of the files above into docker-compose.yml & Dockerfile.dev
respectively, then run the following commands:

```bash
# Unfortunately, yarn does not have a similar command to npx
docker-compose run --rm web npx degit https://github.com/gatsbyjs/gatsby-starter-default . --force
```

Your gatsby project is now ready to dev on! Simply run the following:

```bash
docker-compose up --build
```

Navigate to localhost:8000 in your web browser, and your project should be running!

### Additional info

If you are planning on using yarn instead of npm like I have above, make sure to remove
the package-lock.json generated by degit when pulling in the gatsby starter

```bash
rm package-lock.json
```

#### Updating packages

To update packages you can either do a straight upgrade or an interactive upgrade
as follows.

```bash
# Interactive upgrade
docker-compose run --rm web yarn upgrade-interactive

# Non-interactive
docker-compose run --rm web yarn upgrade
```

If you're not currently inside a git repo and would like to use git, make sure to
run a `git init` from the root directory

## Bonus content - Adding [Docz](https://www.docz.site)

After following the steps above you should have a full gatsby project. It should look like this:

[Gatsby Initial Setup](https://github.com/ParamagicDev/docker-with-gatsby)

```bash
tree .

.
├── docker-compose.yml
├── Dockerfile.dev
├── gatsby-browser.js
├── gatsby-config.js
├── gatsby-node.js
├── gatsby-ssr.js
├── LICENSE
├── node_modules
├── package.json
├── package-lock.json
├── public
├── README.md
├── src
└── yarn.lock
```

Alright, now when I initially tried this I did not realize Docz had released a v2.
Make sure you are targetting v2.

```bash

```

## Issues

When running the docker process, it runs as root. As a result, on Linux the files
created by Degit will be owned by the root user. Run the following to fix
any permissions errors from the root directory:

```bash
sudo chown -R "$USER":"$USER" .
```

## Links

### Gatsby

[Gatsby Home](https://gatsbyjs.org)
</br>
[Gatsby Starter Github page](https://github.com/gatsbyjs/gatsby-starter-default)
</br>

### Degit

> I actually learned about Degit when browsing the Svelte documentation
> </br>

[Degit Source Code](https://github.com/Rich-Harris/degit)
</br>

### Docz

[Docz Homepage](https://www.docz.site)
[Docz Getting Started](https://www.docz.site/docs/getting-started)
