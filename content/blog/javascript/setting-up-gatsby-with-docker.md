---
title: Setting up a Gatsby project with Docker
date: "2020-01-16T16:55:01"
description: How to setup a new gatsby project with docker within the current
  directory of your project
---

## Quick start

First create a new directory (or use an existing directory, this method will NOT
create a new git directory for you)

```bash
mkdir my-new-gatsby-project
cd my-new-gatsby-project
touch Dockerfile.dev docker-compose.yml on yarn.lock
```

```dockerfile
# ./Dockerfile.dev

FROM node:13.6.0-alpine3.11

# Taken from https://www.stoutlabs.com/blog/2019-02-05-my-docker-setup-gatsby-next/
RUN \
  apk add --no-cache python make g++ git && \
  apk add vips-dev fftw-dev --no-cache --repository http://dl-3.alpinelinux.org/alpine/edge/community --repository http://dl-3.alpinelinux.org/alpine/edge/main && \
  rm -fR /var/cache/apk/*

RUN yarn global add gatsby-cli

# The port gatsby runs on
EXPOSE 8000

WORKDIR /myapp
COPY ./package.json .
COPY ./yarn.lock .
RUN yarn install && yarn cache clean
COPY . ./myapp
CMD ["gatsby", "develop", "-H", "0.0.0.0" ]
```

```yaml
# ./docker-compose.yml

version: "3"
services:
  web:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
    volumes:
      - /myapp/node_modules
      - .:/myapp
    environment:
      - NODE_ENV=development
      - GATSBY_WEBPACK_PUBLICPATH=/
```

Your file structure should look as follows when running `tree .`:

```bash
.
├── docker-compose.yml
├── Dockerfile.dev
├── package.json
└── yarn.lock
```

[Reference Repository Commit](https://github.com/ParamagicDev/docker-with-gatsby/tree/initial-docker-setup)

After copying the contents of the files above into docker-compose.yml & Dockerfile.dev
respectively, then run the following commands:

```bash
# Unfortunately, yarn does not have a similar version of npx
docker-compose run --rm web npx degit https://github.com/gatsbyjs/gatsby-starter-default .
```

Your gatsby project is now ready to dev on! Simply run the following:

```bash
docker-compose up --build
```

Navigate to localhost:8000 in your web browser, and your project should be running!

### Additional info

If you are planning on using yarn instead of npm like I have above, make sure to remove
the package-lock.json generated by degit when pulling in the gatsby starter

```bash
rm package-lock.json
```

If you're not currently inside a git repo and would like to use git, make sure to
run a `git init` from the root directory

## Issues

When running the docker process, it runs as root. As a result, on Linux the files
created by Degit will be owned by the root user. Run the following to fix
any permissions errors from the root directory:

```bash
sudo chown -R "$USER":"$USER" .
```

## Links

### Gatsby

[Gatsby Home](https://gatsbyjs.org)
</br>
[Gatsby Starter Github page](https://github.com/gatsbyjs/gatsby-starter-default)
</br>

### Degit

> I actually learned about Degit when browsing the Svelte documentation
> </br>

[Degit Source Code](https://github.com/Rich-Harris/degit)
</br>
